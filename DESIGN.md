# 3D宇宙アクションゲーム 設計

## 概要
リアルロボット風の機体が宇宙空間を自由に移動し、敵機を撃墜する3Dシューティング。
Webブラウザで動作し、キーボード/マウスで操作する。

## ターゲット
- プラットフォーム: Web（Chrome/Edge/Firefox）
- 入力: キーボード + マウス
- 目標FPS: 60fps
- 単位系: メートル・秒・度（角度）

## コアコンセプト
- 6DoF（前後左右上下＋ピッチ/ヨー/ロール）の自由移動
- ブーストと慣性を活かした高速戦闘
- レーザーとファンネルの連携で撃墜

## ゲームループ
1. スタート/リザルト画面
2. 出撃（ステージ開始）
3. 敵機撃墜（スコア加算）
4. 自機撃墜 → 残機-1 → 再出撃（残機0で終了）
5. リザルト表示

## 操作
- 移動: WASD（前後左右）、Space（上昇）、Shift（下降）
- 視点/機体の向き: マウス移動
- ロール: Q/E
- ブースト: Left Ctrl
- 主要武装（レーザー）: 左クリック
- ファンネル: F
- ロックオン: R

## 視点
- 3人称追従カメラ（標準）
- 近距離被弾時は軽いカメラシェイク
- カメラ距離: 12m、高さ: 3m
- 追従スムージング: 0.12s
- シェイク強度: 0.6（最大1.0）、持続: 0.15s、クールダウン: 0.5s

## 主要システム
- 物理/移動
  - 速度、加速度、慣性、最大速度
  - ブースト時の加速倍率、燃料ゲージ
- 戦闘
  - レーザー: 連射、ヒットスキャン
  - ファンネル: ロックオン中の敵を自動追尾・攻撃、呼び戻し可能
  - ロックオン: Rキー、距離と視野角で取得
- 敵AI
  - パトロール/接近/回避/射撃
  - プレイヤーの背後を取る行動
- UI
  - HP/シールド、ブースト燃料
  - ロックオンインジケータ
  - レーダー（簡易）
- 演出
  - 被弾エフェクト、爆発、残光
  - BGM/SE

## ステージ
- 宇宙空間（星空、惑星、スペースデブリ）
- 障害物: 小惑星・残骸

## アセット方針
- 低ポリ/シンプルなメカでプロトタイプ
- 商用ライセンスを避け、オリジナルデザインを採用

## 技術選定（仮）
- エンジン: three.js
- 物理: 自前簡易物理
- ビルド: Vite

## 開発マイルストーン
1. プロトタイプ
   - 自機の6DoF移動
   - 追従カメラ
   - シンプルな敵AI
2. 戦闘実装
  - レーザー/ファンネル
  - ヒット判定
3. UI/演出
   - HUD
   - エフェクト
4. コンテンツ追加
   - ステージ、敵種類

## 仕様確定（詳細）
### ゲームルール
- 初期残機: 3
- クリア条件: 5分生存または敵撃破20機でミッション成功
- 失敗条件: 残機0

### 移動/物理
- 最大速度: 80m/s
- 通常加速度: 40m/s^2
- ブースト倍率: 2.0（最大速度 160m/s）
- 旋回速度: ピッチ/ヨー 120°/s、ロール 160°/s
- ブースト燃料: 5.0s（連続使用）
- 燃料回復: ブースト停止後 1.0s で開始、10%/s
- 速度減衰: 無し（完全慣性）。ブレーキは `S` で逆加速

### 戦闘/ロックオン
- レーザー
  - 連射: 8発/秒
  - ダメージ: 10
  - 射程: 500m
  - 命中判定: ヒットスキャン、視線方向のレイ
- ファンネル
  - 基本数: 6基
  - 発進/帰還: 0.5s / 1.0s
  - 攻撃間隔: 0.4s
  - ダメージ: 6
  - 稼働時間: 8.0s（尽きたら自動帰還）
  - 追従: ロックオン対象を中心に半径20mで周回し攻撃
  - 対象切替: ロックオン対象変更時に即時追従変更
- ロックオン
  - 取得距離: 300m 以内
  - 取得視野角: 30° 以内
  - 優先度: 視野中心に最も近い角度 → 距離
  - 解除: 対象が視野外 or 350m 超過 or 手動解除

### 耐久/ダメージ
- プレイヤーHP: 100
- シールド: 60
- シールド回復: 被弾後2.0sで開始、10/s

### 敵AI（状態遷移）
- Patrol → Chase: 距離 < 400m またはロックオン検知
- Chase → Attack: 距離 < 250m かつ視野角 < 20°
- Attack → Evade: シールド < 20% または被弾直後
- Evade → Chase: 距離 250–400m へ復帰
- すべて → Patrol: プレイヤー見失い（距離 > 500m が 5s 継続）

### 敵種類/出現パターン
- Grunt: HP 60 / シールド 30 / 4発/秒
- Ace: HP 120 / シールド 60 / 6発/秒、回避行動優先
- 同時出現上限: 10
- 出現間隔: 8–12s（経過時間に応じて短縮、下限5s）

### UI/HUD
- ロックオン表示: 対象にリング + 距離表示
- レーダー: 半径 600m を2D表示（敵のみ）

### ステージ/障害物
- 戦闘空域: 半径 1000m の球形エリア
- 障害物数: 30（半径 8–30m）
- 生成範囲: 200–800m
- 衝突: 障害物は球コライダー

### スコア
- 撃破スコア: Grunt 100 / Ace 250
- 連続撃破ボーナス: 10秒以内の連続撃破で +50
- クリアタイムボーナス: 残り時間 × 2

### パフォーマンス制約
- アクティブ弾数上限: 200
- ファンネル総数上限: 12
- 1フレームの衝突候補数: 300以内
